<section class="shows-admin">
  <div class="list-card">
    <header>
      <h2>Scheduled shows</h2>
      <button mat-stroked-button color="primary" (click)="loadData()" [disabled]="loading">Refresh</button>
    </header>

    <div class="loading" *ngIf="loading">
      <mat-progress-spinner diameter="36" mode="indeterminate"></mat-progress-spinner>
      <span>Loading shows…</span>
    </div>

    <table mat-table [dataSource]="dataSource" *ngIf="!loading && shows.length">
      <ng-container matColumnDef="movie">
        <th mat-header-cell *matHeaderCellDef>Movie</th>
        <td mat-cell *matCellDef="let show">{{ displayMovieTitle(show) }}</td>
      </ng-container>

      <ng-container matColumnDef="theater">
        <th mat-header-cell *matHeaderCellDef>Venue</th>
        <td mat-cell *matCellDef="let show">{{ displayTheater(show) }}</td>
      </ng-container>

      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef>Starts</th>
        <td mat-cell *matCellDef="let show">{{ show.startsAtUtc | date: 'MMM d, h:mm a' }}</td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price</th>
        <td mat-cell *matCellDef="let show">&#8377;{{ show.price | number: '1.0-0' }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let show" class="actions">
          <button mat-button color="primary" (click)="edit(show)">Edit</button>
          <button mat-button color="warn" (click)="delete(show)">Delete</button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div class="empty" *ngIf="!loading && !shows.length">
      No shows scheduled yet.
    </div>
  </div>

  <div class="form-card">
    <header>
      <h2>{{ editingShow ? 'Edit show' : 'Create show' }}</h2>
      <button mat-button *ngIf="editingShow" (click)="resetForm()">Reset</button>
    </header>

    <form [formGroup]="showForm" (ngSubmit)="submit()">
      <mat-form-field appearance="outline">
        <mat-label>Movie</mat-label>
        <mat-select formControlName="movieId">
          <mat-option *ngFor="let movie of movies" [value]="movie.id">{{ movie.title }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Theater</mat-label>
        <mat-select formControlName="theaterId">
          <mat-option *ngFor="let theater of theaters" [value]="theater.id">{{ theater.name }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Screen</mat-label>
        <mat-select formControlName="screenId">
          <mat-option *ngFor="let screen of filteredScreens" [value]="screen.id">
            {{ screen.name }} ({{ screen.totalSeats }} seats)
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Start time</mat-label>
        <input matInput type="datetime-local" formControlName="startsAt" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Ticket price</mat-label>
        <input matInput type="number" formControlName="price" />
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit" [disabled]="saving">
        <mat-progress-spinner *ngIf="saving" diameter="20" mode="indeterminate"></mat-progress-spinner>
        <span *ngIf="!saving">{{ editingShow ? 'Save changes' : 'Create show' }}</span>
      </button>
    </form>
  </div>
</section>
